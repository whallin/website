---
import PixelarticonsArrowRight from "../icons/PixelarticonsArrowRight.astro";
import PixelarticonsMail from "../icons/PixelarticonsMail.astro";
import PixelarticonsMailCheck from "../icons/PixelarticonsMailCheck.astro";
import PixelarticonsMailDelete from "../icons/PixelarticonsMailDelete.astro";
import LicensingContactDetails from "./LicensingContactDetails.astro";
import LicensingContactInfo from "./LicensingContactInfo.astro";
import LicensingContactTimeline from "./LicensingContactTimeline.astro";

const locale = (Astro.currentLocale as "en" | "sv") ?? "en";

const translations = {
  en: {
    heading: "Request a license",
    description:
      "Ready to license my work? Fill out the form below with your project details, and I'll get back to you with a quote and license agreement.",
    securityVerificationAriaLabel: "Security verification",
    sendLicensingRequest: "Send licensing request",
    successMessage:
      "Licensing request sent successfully! I'll get back within 24 hours.",
    errorMessage: "Sending failed! Try again.",
  },
  sv: {
    heading: "Begär en licens",
    description:
      "Redo att licensiera mitt arbete? Fyll i formuläret nedan med dina projektuppgifter, så återkommer jag med en offert och licensavtal.",
    securityVerificationAriaLabel: "Säkerhetsverifiering",
    sendLicensingRequest: "Skicka licensförfrågan",
    successMessage: "Licensförfrågan skickad! Jag återkommer inom 24 timmar.",
    errorMessage: "Skickandet misslyckades! Försök igen.",
  },
};
---

<section
  id="license-form-section"
  aria-labelledby="license-form-heading"
  class="space-y-8"
>
  <header class="space-y-4">
    <h2
      id="license-form-heading"
      class="font-serif text-2xl text-stone-800 dark:text-stone-100"
    >
      <PixelarticonsMail aria-hidden="true" class="mr-1 mb-1 inline h-6 w-6" />
      {translations[locale].heading}
    </h2>
    <p class="leading-relaxed text-stone-500">
      {translations[locale].description}
    </p>
  </header>

  <form
    id="licensing-inquiry-form"
    method="post"
    class="flex flex-col gap-4 overflow-hidden border-stone-300 sm:border sm:p-6 dark:border-stone-700"
  >
    <LicensingContactInfo />
    <LicensingContactDetails />
    <LicensingContactTimeline />

    <div
      id="turnstile-container"
      aria-label={translations[locale].securityVerificationAriaLabel}
      class="hidden"
    >
    </div>

    <button
      type="submit"
      id="licensing-submit-btn"
      class="group flex w-full cursor-pointer items-center justify-center gap-1 bg-[#FF3030] p-2 text-sm font-medium tracking-tight text-stone-50 transition hover:opacity-75 active:scale-[0.97] active:opacity-50 disabled:cursor-not-allowed disabled:opacity-50"
    >
      <PixelarticonsMail aria-hidden="true" class="h-4 w-4" />
      <span>{translations[locale].sendLicensingRequest}</span>
      <PixelarticonsArrowRight
        aria-hidden="true"
        class="h-4 w-4 transition-transform group-hover:translate-x-0.5"
      />
    </button>

    <div
      id="licensing-success-message"
      role="status"
      aria-live="polite"
      class="hidden w-full flex-wrap items-center justify-center gap-1 bg-green-600 p-2 text-sm text-stone-50"
    >
      <PixelarticonsMailCheck aria-hidden="true" class="h-4 w-4" />
      <span>{translations[locale].successMessage}</span>
    </div>

    <div
      id="licensing-error-message"
      role="alert"
      aria-live="assertive"
      class="hidden w-full flex-wrap items-center justify-center gap-1 bg-red-600 p-2 text-sm text-stone-50"
    >
      <PixelarticonsMailDelete aria-hidden="true" class="h-4 w-4" />
      <span id="licensing-error-text">{translations[locale].errorMessage}</span>
    </div>
  </form>
</section>

<script>
  import "./LicensingContact";
</script>
