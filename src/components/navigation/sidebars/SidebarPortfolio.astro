---
import { getCollection } from "astro:content";
import PixelarticonsBriefcase from "../../icons/PixelarticonsBriefcase.astro";
import PixelarticonsHumanHandsup from "../../icons/PixelarticonsHumanHandsup.astro";
import SidebarBase from "../SidebarBase.astro";

const locale = (Astro.currentLocale as "en" | "sv") ?? "en";

const allPortfolioEntries = await getCollection(
  "portfolioCollection",
  ({ id, data }) => {
    return id.startsWith(`${locale}/`) && !data.draft;
  },
);

const mostRecentProject = allPortfolioEntries
  .sort((a, b) => a.data.publishedDate.localeCompare(b.data.publishedDate))
  .reverse()[0];

const translations = {
  en: {
    projectsShowcased: "Projects showcased",
    mostRecentProject: "Most recent project",
  },
  sv: {
    projectsShowcased: "Visade projekt",
    mostRecentProject: "Senaste projekt",
  },
};

const stats = [
  {
    label: translations[locale].projectsShowcased,
    value: allPortfolioEntries.length.toString(),
    Icon: PixelarticonsBriefcase,
  },
  {
    label: translations[locale].mostRecentProject,
    value: mostRecentProject?.data.title || "N/A",
    Icon: PixelarticonsHumanHandsup,
  },
];
---

<SidebarBase showLogo showReturn slot="sidebar">
  <div slot="content">
    <aside class="space-y-4 text-xs text-stone-500">
      {
        stats.map((stat) => (
          <div class="space-y-0.5">
            <span class="mb-1 flex items-center gap-1">
              <stat.Icon aria-hidden="true" class="h-4 w-4" />
              {stat.label}
            </span>
            <span class="font-mono text-stone-800 dark:text-stone-300">
              {stat.value}
            </span>
          </div>
        ))
      }
    </aside>
  </div>
</SidebarBase>
