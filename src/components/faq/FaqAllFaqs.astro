---
import { getCollection } from "astro:content";
import FaqItem from "./FaqItem.astro";

const locale = (Astro.currentLocale as "en" | "sv") ?? "en";
const faqCollections = await getCollection("faqCollection");

const faqData = faqCollections.flatMap((collection) => {
  return collection.data.items.map((item) => ({
    category: collection.data.categoryLabel[locale],
    question: item.question[locale],
    answer: item.answer[locale],
  }));
});

const groupedFaqs = faqData.reduce(
  (acc, faq) => {
    if (!acc[faq.category]) {
      acc[faq.category] = [];
    }
    acc[faq.category].push(faq);
    return acc;
  },
  {} as Record<string, typeof faqData>,
);
---

<section aria-labelledby="faq-heading">
  <div class="space-y-12">
    {
      Object.entries(groupedFaqs).map(([category, faqs]) => (
        <article class="space-y-4">
          <h2
            id={`faq-category-${category.toLowerCase().replace(/\s+/g, "-")}`}
            class="font-serif text-xl text-stone-800 dark:text-stone-100"
          >
            {category}
          </h2>

          <div
            role="group"
            aria-labelledby={`faq-category-${category.toLowerCase().replace(/\s+/g, "-")}`}
            class="space-y-6"
          >
            {faqs.map((faq) => (
              <FaqItem
                question={faq.question}
                answer={faq.answer}
                category={faq.category}
              />
            ))}
          </div>
        </article>
      ))
    }
  </div>
</section>
