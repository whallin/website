---
export const prerender = true;

import { getCollection, render } from "astro:content";
import PixelarticonsCalendar from "../../../components/icons/PixelarticonsCalendar.astro";
import SidebarBase from "../../../components/navigation/SidebarBase.astro";
import PageHeaderImg from "../../../components/PageHeaderImg.astro";
import LayoutBase from "../../../layouts/LayoutBase.astro";
import { formatDate } from "../../../utils/blog";

export async function getStaticPaths() {
  const portfolioItems = await getCollection(
    "portfolioCollection",
    ({ id }) => {
      return id.startsWith("en/");
    },
  );
  return portfolioItems.map((item) => ({
    params: { id: item.id.replace("en/", "") },
    props: { portfolioItem: item },
  }));
}

const { portfolioItem } = Astro.props;
const { Content } = await render(portfolioItem);

const formattedDate = formatDate(portfolioItem.data.publishedDate, "en-US");

const schema = {
  "@context": "https://schema.org",
  "@type": "CreativeWork",
  mainEntityOfPage: {
    "@type": "WebPage",
    "@id": Astro.url,
  },
  headline: portfolioItem.data.title,
  description: portfolioItem.data.description,
  image: portfolioItem.data.thumbnailImg,
  creator: {
    "@type": "Person",
    name: "William Hallin",
    url: "https://hallin.media",
  },
  publisher: {
    "@type": "Organization",
    name: "HallinMedia",
    logo: {
      "@type": "ImageObject",
      url: "https://hallin.media/meta.png",
    },
  },
  datePublished: portfolioItem.data.publishedDate,
  dateModified: portfolioItem.data.publishedDate,
  genre: portfolioItem.data.category,
};
---

<LayoutBase
  title={portfolioItem.data.title}
  description={portfolioItem.data.description}
  schema={schema}
>
  <SidebarBase showLogo showReturn slot="sidebar">
    <div slot="content">
      <aside
        class="space-y-4 text-xs text-stone-500"
        aria-label="Project metadata"
      >
        <div class="space-y-0.5">
          <span class="mb-1 flex items-center gap-1">
            <PixelarticonsCalendar aria-hidden="true" class="h-4 w-4" />
            Published
          </span>
          <time
            datetime={portfolioItem.data.publishedDate}
            class="font-mono text-stone-800 dark:text-stone-300"
          >
            {formattedDate}
          </time>
        </div>
        <div class="flex flex-col space-y-0.5">
          <span class="mb-1 text-stone-500"> Category </span>
          <span
            class="font-mono text-xs font-medium tracking-wider text-red-400 uppercase"
          >
            {portfolioItem.data.category}
          </span>
        </div>
      </aside>
    </div>
  </SidebarBase>

  <article slot="content" class="space-y-8">
    <header>
      <PageHeaderImg
        headerImgSrc={portfolioItem.data.thumbnailImg}
        headerImgAlt={portfolioItem.data.thumbnailImgAlt}
        headingText={portfolioItem.data.title}
        headingItalic={false}
        descriptionText={portfolioItem.data.description}
        showBtn={false}
      />

      <aside
        class="mt-6 mb-12 flex flex-wrap gap-6 text-xs text-stone-500 md:hidden"
        aria-label="Project metadata"
      >
        <div class="space-y-0.5">
          <span class="mb-1 flex items-center gap-1">
            <PixelarticonsCalendar aria-hidden="true" class="h-4 w-4" />
            Published
          </span>
          <time
            datetime={portfolioItem.data.publishedDate}
            class="font-mono text-stone-800 dark:text-stone-300"
          >
            {formattedDate}
          </time>
        </div>
        <div class="flex flex-col space-y-0.5">
          <span class="mb-1 text-stone-500"> Category </span>
          <span
            class="font-mono text-xs font-medium tracking-wider text-red-400 uppercase"
          >
            {portfolioItem.data.category}
          </span>
        </div>
      </aside>
    </header>

    <main
      class="prose dark:prose-invert prose-stone prose-headings:font-serif prose-headings:font-medium prose-a:hover:bg-red-400 prose-a:hover:text-stone-100 prose-a:active:opacity-50 prose-a:decoration-dashed prose-a:decoration-from-font prose-a:underline-offset-2"
    >
      <Content />
    </main>
  </article>
</LayoutBase>
