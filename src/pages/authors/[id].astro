---
import { Picture } from "astro:assets";
import { getCollection } from "astro:content";
import AuthorBlogPosts from "../../components/authors/AuthorBlogPosts.astro";
import AuthorLinks from "../../components/authors/AuthorLinks.astro";
import PixelarticonsFlag from "../../components/icons/PixelarticonsFlag.astro";
import PixelarticonsMail from "../../components/icons/PixelarticonsMail.astro";
import SidebarBase from "../../components/navigation/SidebarBase.astro";
import LayoutBase from "../../layouts/LayoutBase.astro";

export async function getStaticPaths() {
  const authors = await getCollection("authorCollection");
  return authors.map((author) => ({
    params: { id: author.id },
    props: { author },
  }));
}

const { author } = Astro.props;
const locale = (Astro.currentLocale as "en" | "sv") ?? "en";
---

<LayoutBase>
  <SidebarBase showLogo showReturn slot="sidebar">
    <div slot="content">
      <aside class="space-y-4 text-xs text-stone-500">
        {
          author.data.location && (
            <div class="space-y-0.5">
              <span class="mb-1 flex items-center gap-1">
                <PixelarticonsFlag aria-hidden="true" class="h-4 w-4" />
                Location
              </span>
              <span class="font-mono text-stone-800 dark:text-stone-300">
                {author.data.location}
              </span>
            </div>
          )
        }

        {
          author.data.email && (
            <div class="space-y-0.5">
              <span class="mb-1 flex items-center gap-1">
                <PixelarticonsMail aria-hidden="true" class="h-4 w-4" />
                Contact
              </span>
              <a
                href={`mailto:${author.data.email}`}
                class="font-mono text-stone-800 hover:bg-red-400 hover:text-stone-100 active:opacity-50 dark:text-stone-300"
              >
                {author.data.email}
              </a>
            </div>
          )
        }
      </aside>
    </div>
  </SidebarBase>

  <main slot="content" class="space-y-12">
    <article class="space-y-6">
      <header class="space-y-6">
        <Picture
          src={author.data.avatar}
          alt={author.data.name}
          width={64}
          height={64}
          quality={80}
          formats={["avif"]}
          layout="constrained"
          fit="cover"
          position="center"
          transition:name={`avatar-${author.id}`}
          class="mb-6 rounded-full select-none"
        />

        <div class="space-y-3">
          <h1 class="font-serif text-xl text-stone-800 dark:text-stone-100">
            {author.data.name}
          </h1>
          <p class="max-w-xl leading-relaxed text-stone-500">
            {author.data.bio[locale]}
          </p>
          <span class="text-sm text-stone-800 md:hidden dark:text-stone-300">
            <PixelarticonsFlag aria-hidden="true" class="mr-1 inline h-4 w-4" />
            {author.data.location}
          </span>
        </div>
      </header>

      <AuthorLinks author={author} />
    </article>

    <hr class="border-stone-300 dark:border-stone-700" />

    <AuthorBlogPosts author={author} />
  </main>
</LayoutBase>
